# TeleBotCore

# TeleBotCore - Modular Telegram Bot Template

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11+-blue.svg)
![Aiogram](https://img.shields.io/badge/Aiogram-3.22-green.svg)
![SQLAlchemy](https://img.shields.io/badge/SQLAlchemy-2.0-orange.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

**–ú–æ–¥—É–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤ —Å —Å–∏—Å—Ç–µ–º–æ–π –ø–ª–∞–≥–∏–Ω–æ–≤**

[–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏) ‚Ä¢ [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç) ‚Ä¢ [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞) ‚Ä¢ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

</div>

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- **–°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **–ê–≤—Ç–æ—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - –ø–ª–∞–≥–∏–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è
- **–ò–∑–æ–ª—è—Ü–∏—è** - –∫–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–≤–æ–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ

### **–ì–æ—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** - Async SQLAlchemy —Å –º–æ–¥–µ–ª—è–º–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- **FSM** - –∫–æ–Ω–µ—á–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã** - –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - Pydantic settings —Å env —Ñ–∞–π–ª–∞–º–∏

### **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- **Dependency Injection** - —á–∏—Å—Ç–∞—è –∏–Ω–∂–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **Middleware** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏ –ø–ª–∞–≥–∏–Ω–Ω—ã–µ middleware
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –≥–ª–æ–±–∞–ª—å–Ω—ã–π error handling
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
git clone https://github.com/yourname/TeleBotCore.git
cd TeleBotCore
pip install -r requirements.txt
````

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞
```.dotenv
BOT_TOKEN=your_bot_token_here
ADMIN_IDS=[123456789]
DATABASE_URL=sqlite+aiosqlite:///db.sqlite3
SUPPORT=your_support_username
PLUGINS_DISPLAY_MODE=integrated
```

### 3. –ó–∞–ø—É—Å–∫
```bash
python main.py
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
TeleBotCore/
‚îú‚îÄ‚îÄ core/                   # –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ bot/                # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ config/             # –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ plugins/            # –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ filters/            # –§–∏–ª—å—Ç—Ä—ã –¥–ª—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/        # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/          # –ü–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îÇ   ‚îú‚îÄ‚îÄ display/            # HTML –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ handlers/           # –ë–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îú‚îÄ‚îÄ databases/              # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models.py           # –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ user_manager.py     # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ database_manager.py # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–µ–π
‚îú‚îÄ‚îÄ plugins/                # –ü–ª–∞–≥–∏–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py         # –ê–≤—Ç–æ–∏–º–ø–æ—Ä—Ç –ø–ª–∞–≥–∏–Ω–æ–∞
‚îî‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
```

## –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞
### 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–∞–≥–∏–Ω–∞
```
plugins/
‚îî‚îÄ‚îÄ my_plugin/
    ‚îú‚îÄ‚îÄ __init__.py     # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞
    ‚îú‚îÄ‚îÄ config.py       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–∞–≥–∏–Ω–∞
    ‚îú‚îÄ‚îÄ plugin.py       # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø–ª–∞–≥–∏–Ω–∞
    ‚îú‚îÄ‚îÄ handlers.py     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    ‚îú‚îÄ‚îÄ keyboards.py    # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
    ‚îú‚îÄ‚îÄ models.py       # –ú–æ–¥–µ–ª–∏ –ë–î (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    ‚îú‚îÄ‚îÄ services.py     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    ‚îî‚îÄ‚îÄ fsm.py          # –°–æ—Å—Ç–æ—è–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 2. –ü—Ä–∏–º–µ—Ä –ø–ª–∞–≥–∏–Ω–∞
`plugins/my_plugin/config.py`
```python
from pydantic_settings import BaseSettings

# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –ø–ª–∞–≥–∏–Ω
ENABLED: bool = True

class PluginSettings(BaseSettings):
    API_KEY: str = "default_key"
    MAX_USERS: int = 100
    
    model_config = {"env_file": ".env", "env_prefix": "MYPLUGIN_"}
```

`plugins/my_plugin/plugin.py`
```python
from core.plugins.base import PluginBase
from core.config import ConfigManager
from aiogram import Router
from aiogram.types import InlineKeyboardButton
from databases import DatabaseManager
from .config import PluginSettings
from .handlers import PluginHandlers

class Plugin(PluginBase):
    def __init__(self, config: ConfigManager, db: DatabaseManager):
        self.config = config
        self.db = db
        self.settings = config.load_plugin_config(self.get_name(), PluginSettings)

    def get_router(self) -> Router:
        router = Router(name=self.get_name())
        PluginHandlers(self.settings, self.get_name(), self.db).register(router)
        return router

    def get_integrated_buttons(self):
        return [[InlineKeyboardButton(text="–ú–æ–π –ø–ª–∞–≥–∏–Ω", callback_data="myplugin:main")]]

    def get_entry_button(self):
        return [[InlineKeyboardButton(text="üì± –ú–æ–π –ø–ª–∞–≥–∏–Ω", callback_data="plugin:MYPLUGIN")]]

    def get_config(self):
        return PluginSettings

    def get_settings(self):
        return self.settings
```

`plugins/my_plugin/__init__.py`
```python
from .plugin import Plugin
from core.plugins.registry import register_plugin

register_plugin("my_plugin", lambda config, db: Plugin(config, db))
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (.env)
```dotenv
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ
BOT_TOKEN=your_bot_token
ADMIN_IDS=[123456,789012]

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ
DATABASE_URL=sqlite+aiosqlite:///db.sqlite3
SUPPORT=username_support_bot
PLUGINS_DISPLAY_MODE=integrated  # integrated|entry|smart
```

## –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤
* `integrated` - –∫–Ω–æ–ø–∫–∏ –ø–ª–∞–≥–∏–Ω–æ–≤ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é
* `entry` - –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∫–∞–∂–¥—ã–π –ø–ª–∞–≥–∏–Ω
* `smart` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–Ω–æ–ø–æ–∫

## API —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
### –§–∏–ª—å—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–∞
```python
from core.filters import RoleFilter, PermissionFilter

@router.message(RoleFilter(user_manager, "admin"))
async def admin_command(message: Message):
    await message.answer("–ê–¥–º–∏–Ω –∫–æ–º–∞–Ω–¥–∞")

@router.message(PermissionFilter(user_manager, is_admin=True))
async def moderator_command(message: Message):
    await message.answer("–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –∫–æ–º–∞–Ω–¥–∞")
```

### –†–∞–±–æ—Ç–∞ —Å –ë–î
```python
from databases import UserManager

user_manager = UserManager()
user, created = await user_manager.ensure(
    telegram_id=message.from_user.id,
    username=message.from_user.username
)
```

### FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
```python
from aiogram.fsm.context import FSMContext
from core.fsm.registry import UserFSM

@router.message(UserFSM.awaiting_email)
async def handle_email(message: Message, state: FSMContext):
    email = message.text
    await state.update_data(email=email)
    await message.answer("Email —Å–æ—Ö—Ä–∞–Ω–µ–Ω!")
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
git clone https://github.com/gambojo/TeleBotCore.git
cd TeleBotCore
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏ venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞
...

## –õ–∏—Ü–µ–Ω–∑–∏—è
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.

## –ê–≤—Ç–æ—Ä—ã
* –ê–≥–∞–º–æ–≤ –ì–∞–º–∏–¥ - https://github.com/gambojo
